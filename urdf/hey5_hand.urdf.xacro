<?xml version="1.0"?>
<!--
  Copyright (c) 2014, PAL Robotics, S.L.
  All rights reserved.

  This work is licensed under the Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-nd/3.0/ or send a letter to
  Creative Commons, 444 Castro Street, Suite 900, Mountain View, California, 94041, USA.
-->
<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <!--External resources-->
  <xacro:include filename="$(find hey5_description)/urdf/actuators.urdf.xacro" />
  <xacro:include filename="$(find hey5_description)/urdf/deg_to_rad.urdf.xacro" />
  <xacro:include filename="$(find hey5_description)/urdf/fingers.urdf.xacro" />
  <xacro:include filename="$(find hey5_description)/urdf/palm.urdf.xacro" />

  <!--Command source. TODO: Remove!-->
  <xacro:macro name="cmd_source" params="name parent *origin">
    <joint name="${name}_joint" type="revolute">
      <parent link="${parent}" />
      <child link="${name}_link" />
      <insert_block name="origin" />
      <axis xyz="0 0 1" />
      <limit lower="0.0" upper="1.0" effort="10.0" velocity="20.0" /> <!--TODO: Check-->
      <!--TODO: Add joint dynamics?-->
    </joint>

    <link name="${name}_link">
      <inertial>
        <mass value="0.01" /> <!--TODO: can we make it zero and still have a stable dynamic simulation?-->
        <inertia ixx="0" ixy="0" ixz="0" iyy="0" iyz="0" izz="0" />
      </inertial>
    </link>
  </xacro:macro>



  <!--
    Create a complete hey5 hand (right or left).

    Parameters:
    - name: Hand name. The created links and joints are prepended with 'name_'
    - parent: Parent link
    - reflect: Set to 1 for a right hand, or to -1 for a left hand
    - origin: XML block containing the pose of the palm link with respect to its parent
  -->
  <xacro:macro name="hey5_hand" params="name parent reflect *origin">
    <!--Palm-->
    <xacro:palm parent="${parent}" name="${name}_palm" reflect="${reflect}" >
      <insert_block name="origin" />
    </xacro:palm>

    <!--Command sources-->
<!--    <xacro:cmd_source parent="${name}_palm_link" name="${name}_thumb" >
      <origin xyz="0.05 0 0" rpy="0 0 0" />
    </xacro:cmd_source>

    <xacro:cmd_source parent="${name}_palm_link" name="${name}_index" >
      <origin xyz="0.05 0 0" rpy="0 0 0" />
    </xacro:cmd_source>

    <xacro:cmd_source parent="${name}_palm_link" name="${name}_mrl" >
      <origin xyz="0.05 0 0" rpy="0 0 0" />
    </xacro:cmd_source>-->

    <!-- Actuators -->
    <xacro:thumb_actuator parent="${name}_palm_link" name="${name}_thumb">
      <origin xyz="0 0 0" rpy="0 0 0" /> <!-- TODO: Change! -->
    </xacro:thumb_actuator>

    <xacro:index_actuator parent="${name}_palm_link" name="${name}_index">
      <origin xyz="0 0 0" rpy="0 0 0" /> <!-- TODO: Change! -->
    </xacro:index_actuator>

    <xacro:mrl_actuator parent="${name}_palm_link" name="${name}_mrl">
      <origin xyz="0 0 0" rpy="0 0 0" /> <!-- TODO: Change! -->
    </xacro:mrl_actuator>

    <!--Fingers-->
    <!-- TODO: Add grasp hack? -->
    <xacro:thumb parent="${name}_palm_link" name="${name}_thumb" reflect="${reflect}" mimic_source="${name}_thumb_joint">
      <origin xyz="0.0911 0.0132 ${reflect * 0.038}" rpy="0 ${-reflect * 65 * deg_to_rad} 0" />
    </xacro:thumb>

    <xacro:finger parent="${name}_palm_link" name="${name}_index" reflect="${reflect}" mimic_source="${name}_index_joint">
      <origin xyz="0.1265 0.00399 ${reflect * 0.0265}" rpy="${-reflect * 90 * deg_to_rad} ${-reflect * 15 * deg_to_rad} 0" />
    </xacro:finger>

    <xacro:finger parent="${name}_palm_link" name="${name}_middle" reflect="${reflect}" mimic_source="${name}_mrl_joint">
      <origin xyz="0.1335 0.00399 ${reflect * 0.007}" rpy="${-reflect * 90 * deg_to_rad} 0 0" />
    </xacro:finger>

    <xacro:finger parent="${name}_palm_link" name="${name}_ring" reflect="${reflect}" mimic_source="${name}_mrl_joint">
      <origin xyz="0.1265 0.00399 ${reflect * -0.0125}" rpy="${-reflect * 90 * deg_to_rad} ${reflect * 5 * deg_to_rad} 0" />
    </xacro:finger>

    <xacro:finger parent="${name}_palm_link" name="${name}_little" reflect="${reflect}" mimic_source="${name}_mrl_joint">
      <origin xyz="0.1165 0.00399 ${reflect * -0.032}" rpy="${-reflect * 90 * deg_to_rad} ${reflect * 15 * deg_to_rad} 0" />
    </xacro:finger>
  </xacro:macro>
</robot>

